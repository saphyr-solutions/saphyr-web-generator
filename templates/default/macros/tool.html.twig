{% macro buildSection(current_section) %}
    <div style="{{ _self.getStyles(current_section, "")|trim }}">
        <div class="{{ current_section.classes|join(" ") }}">
            <div class="row gy-5">

                {% set columns = current_section.columns %}
                {% if columns == "col-3_col-3_col-3_col-3" %}
                    {% set columns = "col-sm-6 col-lg-3_col-sm-6 col-lg-3_col-sm-6 col-lg-3_col-md-3" %}
                {% elseif columns == "col-4_col-4_col-4" %}
                    {% set columns = "col-sm-6 col-lg-4_col-sm-6 col-lg-4_col-sm-6 col-lg-4" %}
                {% else %}
                    {% set columns = columns|replace({"col-": "col-md-"}) %}
                {% endif %}

                {% set columnsClasses = columns|split("_") %}
                {% for key, current_bloc in current_section.blocs %}
                    {% set newColumn = not current_bloc.same_column %}
                    {% set closeColumn = not current_section.blocs[key+1].same_column %}
                    {% set keyToSearch = key % columnsClasses|length %}
                    {% set columnClass = columnsClasses[keyToSearch] %}

                    {% if newColumn %}<div class="{{ columnClass }}">{% endif %}
                    {{ include('blocs/' ~ current_bloc.type ~ '.html.twig', {current_bloc: current_bloc}, with_context = true) }}
                    {% if closeColumn %}</div>{% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
{% endmacro %}

{% macro getStyles(element, prefix) %}
    {% set styles = [] %}
    {% if attribute(element, prefix ~ "color") %}
        {% set styles = styles|merge(["color: " ~ attribute(element, prefix ~ "color") ~ "!important"]) %}
    {% endif %}

    {# Background #}
    {% set backgrounds = [] %}
    {% if attribute(element, prefix ~ "background_image") %}
        {% if attribute(element, prefix ~ "background_color") and attribute(element, prefix ~ "background_color_alt") %}
            {% set backgrounds = backgrounds|merge(["linear-gradient(180deg, "~attribute(element, prefix ~ "background_color")~" 0%, "~attribute(element, prefix ~ "background_color_alt")~" 100%)"]) %}
        {% elseif attribute(element, prefix ~ "background_color") %}
            {% set backgrounds = backgrounds|merge(["linear-gradient(180deg, "~attribute(element, prefix ~ "background_color")~" 0%, "~attribute(element, prefix ~ "background_color")~" 100%)"]) %}
        {% elseif attribute(element, prefix ~ "background_color_alt") %}
            {% set backgrounds = backgrounds|merge(["linear-gradient(180deg, "~attribute(element, prefix ~ "background_color_alt")~" 0%, "~attribute(element, prefix ~ "background_color_alt")~" 100%)"]) %}
        {% endif %}
        {% set backgrounds = backgrounds|merge(["url("~asset(attribute(element, prefix ~ "background_image"))~") center center no-repeat"]) %}
    {% elseif attribute(element, prefix ~ "background_color") and attribute(element, prefix ~ "background_color_alt") %}
        {% set backgrounds = backgrounds|merge(["linear-gradient(180deg, "~attribute(element, prefix ~ "background_color")~" 0%, "~attribute(element, prefix ~ "background_color_alt")~" 100%)"]) %}
    {% elseif attribute(element, prefix ~ "background_color") %}
        {% set backgrounds = backgrounds|merge([attribute(element, prefix ~ "background_color")]) %}
    {% elseif attribute(element, prefix ~ "background_color_alt") %}
        {% set backgrounds = backgrounds|merge([attribute(element, prefix ~ "background_color_alt")]) %}
    {% endif %}

    {% if backgrounds %}
        {% set styles = styles|merge(["background:" ~ backgrounds|join(", "), "background-repeat: no-repeat", "background-size: cover"]) %}
    {% endif %}

    {{ styles|join("; ") }}
{% endmacro %}

{% macro img(current_bloc,classes="",html="") %}
    {% if current_bloc.image_link %}<a href="{{ current_bloc.image_link }}">{% endif %}
    <img class="{{ classes }}" src="{{ asset(current_bloc.image) }}" {{ html }} alt="{{ current_bloc.image.client_name }}">
    {% if current_bloc.image_link %}</a>{% endif %}
{% endmacro %}

{% macro header(current_bloc, level = "1",classes="",html="") %}
     <h{{ level}} class="{{ current_bloc.classes|join(" ") }} {{ classes }} " style="{{ _self.getStyles(current_bloc, "title_")|trim }}"  {{ html }}>{{ current_bloc.title|snl2br|raw }}</h{{ level }}>
{% endmacro %}

{% macro button(current_bloc, classes="",html="") %}
    <div class="{{ current_bloc.button_align }}">
        <a href="{{ current_bloc.button_link ?: "#" }}" style="{{ _self.getStyles(current_bloc, "button_")|trim }}" class="mt-5 btn {{ current_bloc.button_classes|join(" ") }} {{ classes }}" {{ html }}>
            {% if current_bloc.button_logo %}<img src="{{ asset(current_bloc.button_logo) }}" class="me-2">{% endif %}
            {{ current_bloc.button_text }}
        </a>
    </div>
{% endmacro %}

{% macro icon(current_bloc, classes="",html="") %}
    <div class="{{ current_bloc.icon_classes|join(" ") }}">
        {% set classes = 'rounded-pill p-4 d-inline-block text-center w-25' ~ classes %}
        {% set styles = _self.getStyles(current_bloc, "icon_")|trim %}
        {% if current_bloc.icon_link %}<a style="{{ styles }}" {{ html}} class="{{ classes }}" href="{{ current_bloc.icon_link }}" target="{{ current_bloc.icon_target }}">{% else %}<span style="{{ styles }}" {{ html}} class="{{ classes }}">{% endif %}
        <img src="{{ asset(current_bloc.icon_logo) }}" alt="" class="img-fluid">
        {% if current_bloc.icon_link %}</a>{% else %}</span>{% endif %}
    </div>
{% endmacro %}

{% macro label(current_bloc, number, classes="",html="") %}
  <span class="badge rounded-pill" style="{{ _self.getStyles(current_bloc, "label_"~number~"_")|trim }}">
      {% if attribute(current_bloc,"label_"~number~"_link") %}
          <a href="{{ attribute(current_bloc,"label_"~number~"_link") }}" target="{{ attribute(current_bloc,"label_"~number~"_target") }}" style="color: inherit;">{{ attribute(current_bloc,"label_"~number~"_label") }}</a>
      {% else %}
          <span class="h6 text-uppercase">{{ attribute(current_bloc,"label_"~number~"_label") }}</span>
      {% endif %}
  </span>
{% endmacro %}